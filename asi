# prep
set mol 0
set num [molinfo $mol get numframes]
set ox [atomselect $mol {name O}]
set all [atomselect $mol {all}]
# create a selection for each oxygen atom to compute
foreach i [$ox get index] {
set sel($i) [atomselect $mol "exwithin 1.30 of index $i"]
}
# loop over all frames, and for each frame loop over
# all oxygens and store the number of hydrogens in user
for {set n 0} {$n < $num} {incr n} {
set bc {}
foreach i [$ox get index] {
$sel($i) frame $n
$sel($i) update
$all frame $n
$all set user 0
lappend bc [$sel($i) num]
}
$ox frame $n
$ox set user $bc
unset bc
}
# clean up selections
foreach i [$ox get index] {
$sel($i) delete
}
$ox delete
$all delete
unset ox all sel i n

